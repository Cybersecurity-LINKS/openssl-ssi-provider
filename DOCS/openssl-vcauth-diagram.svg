<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2185px" preserveAspectRatio="none" style="width:1317px;height:2185px;" version="1.1" viewBox="0 0 1317 2185" width="1317px" zoomAndPan="magnify"><defs><filter height="300%" id="fllnwswvjzc9s" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="280.1953" style="stroke: #000000; stroke-width: 2.0;" width="1075.5" x="46" y="94.4297"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="46.2656" style="stroke: #000000; stroke-width: 2.0;" width="422" x="507" y="218.9609"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="88.3984" style="stroke: #000000; stroke-width: 2.0;" width="320.5" x="791" y="279.2266"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="280.1953" style="stroke: #000000; stroke-width: 2.0;" width="1075.5" x="46" y="388.625"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="46.2656" style="stroke: #000000; stroke-width: 2.0;" width="422" x="507" y="513.1563"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="88.3984" style="stroke: #000000; stroke-width: 2.0;" width="320.5" x="791" y="573.4219"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="303.3281" style="stroke: #000000; stroke-width: 2.0;" width="968.5" x="263.5" y="721.9531"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="604.5" x="507" y="817.3516"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="316.3281" style="stroke: #000000; stroke-width: 2.0;" width="1039.5" x="263.5" y="1078.4141"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="95.3984" style="stroke: #000000; stroke-width: 2.0;" width="786" x="507" y="1173.8125"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="604.5" x="507" y="1312.3438"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="251.0625" style="stroke: #000000; stroke-width: 2.0;" width="868" x="263.5" y="1447.875"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="148.6641" style="stroke: #000000; stroke-width: 2.0;" width="614.5" x="507" y="1543.2734"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="88.3984" style="stroke: #000000; stroke-width: 2.0;" width="320.5" x="791" y="1596.5391"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="375.7266" style="stroke: #000000; stroke-width: 2.0;" width="1042.5" x="263.5" y="1752.0703"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="154.7969" style="stroke: #000000; stroke-width: 2.0;" width="789" x="507" y="1847.4688"/><rect fill="#FFFFFF" filter="url(#fllnwswvjzc9s)" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="604.5" x="507" y="2045.3984"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="101" x2="101" y1="38.2969" y2="2144.7969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="304.5" x2="304.5" y1="38.2969" y2="2144.7969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="565" x2="565" y1="38.2969" y2="2144.7969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="711" x2="711" y1="38.2969" y2="2144.7969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="860" x2="860" y1="38.2969" y2="2144.7969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1018.5" x2="1018.5" y1="38.2969" y2="2144.7969"/><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="56" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="63" y="22.9951">S_SERVER</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="56" y="2143.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="63" y="2163.792">S_SERVER</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="273.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="280.5" y="22.9951">LIBSSL</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="59" x="273.5" y="2143.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="280.5" y="2163.792">LIBSSL</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="517" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="524" y="22.9951">LIBCRYPTO</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="517" y="2143.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="524" y="2163.792">LIBCRYPTO</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="631" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="638" y="22.9951">DEFAULT_PROVIDER</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="156" x="631" y="2143.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="638" y="2163.792">DEFAULT_PROVIDER</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="801" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="808" y="22.9951">SSI_PROVIDER</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="801" y="2143.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="808" y="2163.792">SSI_PROVIDER</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="936.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="943.5" y="22.9951">IDENTITY_CBINDINGS</text><rect fill="#FEFECE" filter="url(#fllnwswvjzc9s)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="936.5" y="2143.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="943.5" y="2163.792">IDENTITY_CBINDINGS</text><path d="M39,53.2969 L39,78.2969 L1079,78.2969 L1079,63.2969 L1069,53.2969 L39,53.2969 " fill="#FBFB77" filter="url(#fllnwswvjzc9s)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1069,53.2969 L1069,63.2969 L1079,63.2969 L1069,53.2969 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="849" x="128.25" y="70.3638">The server first loads its VC and DID into EVP_PKEY *VC and EVP_PKEY *did that are stored in an appropriate data structure in LIBSSL</text><path d="M46,94.4297 L162,94.4297 L162,101.4297 L152,111.4297 L46,111.4297 L46,94.4297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="280.1953" style="stroke: #000000; stroke-width: 2.0;" width="1075.5" x="46" y="94.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="61" y="107.4966">LOAD DID</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="101" x2="143" y1="132.6953" y2="132.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="143" x2="143" y1="132.6953" y2="145.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="102" x2="143" y1="145.6953" y2="145.6953"/><polygon fill="#A80036" points="112,141.6953,102,145.6953,112,149.6953,108,145.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="108" y="127.6294">load_key(did_document.pem)</text><polygon fill="#A80036" points="553,170.8281,563,174.8281,553,178.8281,557,174.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="101" x2="559" y1="174.8281" y2="174.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="108" y="169.7622">OSSL_DECODER_from_bio()</text><polygon fill="#A80036" points="699,199.9609,709,203.9609,699,207.9609,703,203.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="705" y1="203.9609" y2="203.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="572" y="198.895">pem2der_decode()</text><path d="M507,218.9609 L641,218.9609 L641,225.9609 L631,235.9609 L507,235.9609 L507,218.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="46.2656" style="stroke: #000000; stroke-width: 2.0;" width="422" x="507" y="218.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="522" y="232.0278">DECODE_OP</text><polygon fill="#A80036" points="848,253.2266,858,257.2266,848,261.2266,852,257.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="854" y1="257.2266" y2="257.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="572" y="252.1606">PrivateKeyInfo_der_to_vc_decode()</text><path d="M791,279.2266 L938,279.2266 L938,286.2266 L928,296.2266 L791,296.2266 L791,279.2266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="88.3984" style="stroke: #000000; stroke-width: 2.0;" width="320.5" x="791" y="279.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="806" y="292.2935">KEYMGMT_OP</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="902" y1="317.4922" y2="317.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="902" x2="902" y1="317.4922" y2="330.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="902" y1="330.4922" y2="330.4922"/><polygon fill="#A80036" points="871,326.4922,861,330.4922,871,334.4922,867,330.4922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="867" y="312.4263">vc_load()</text><polygon fill="#A80036" points="1007,355.625,1017,359.625,1007,363.625,1011,359.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="1013" y1="359.625" y2="359.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="867" y="354.5591">did_set()</text><path d="M46,388.625 L156,388.625 L156,395.625 L146,405.625 L46,405.625 L46,388.625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="280.1953" style="stroke: #000000; stroke-width: 2.0;" width="1075.5" x="46" y="388.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="61" y="401.6919">LOAD VC</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="101" x2="143" y1="426.8906" y2="426.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="143" x2="143" y1="426.8906" y2="439.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="102" x2="143" y1="439.8906" y2="439.8906"/><polygon fill="#A80036" points="112,435.8906,102,439.8906,112,443.8906,108,439.8906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="108" y="421.8247">load_key(jwt.pem)</text><polygon fill="#A80036" points="553,465.0234,563,469.0234,553,473.0234,557,469.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="101" x2="559" y1="469.0234" y2="469.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="108" y="463.9575">OSSL_DECODER_from_bio(jwt.pem)</text><polygon fill="#A80036" points="699,494.1563,709,498.1563,699,502.1563,703,498.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="705" y1="498.1563" y2="498.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="572" y="493.0903">pem2der_decode()</text><path d="M507,513.1563 L641,513.1563 L641,520.1563 L631,530.1563 L507,530.1563 L507,513.1563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="46.2656" style="stroke: #000000; stroke-width: 2.0;" width="422" x="507" y="513.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="522" y="526.2231">DECODE_OP</text><polygon fill="#A80036" points="848,547.4219,858,551.4219,848,555.4219,852,551.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="854" y1="551.4219" y2="551.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="572" y="546.356">PublicKeyInfo_der_to_vc_decode()</text><path d="M791,573.4219 L938,573.4219 L938,580.4219 L928,590.4219 L791,590.4219 L791,573.4219 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="88.3984" style="stroke: #000000; stroke-width: 2.0;" width="320.5" x="791" y="573.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="806" y="586.4888">KEYMGMT_OP</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="902" y1="611.6875" y2="611.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="902" x2="902" y1="611.6875" y2="624.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="902" y1="624.6875" y2="624.6875"/><polygon fill="#A80036" points="871,620.6875,861,624.6875,871,628.6875,867,624.6875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="867" y="606.6216">vc_load()</text><polygon fill="#A80036" points="1007,649.8203,1017,653.8203,1007,657.8203,1011,653.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="1013" y1="653.8203" y2="653.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="867" y="648.7544">vc_set()</text><path d="M39,680.8203 L39,705.8203 L1079,705.8203 L1079,690.8203 L1069,680.8203 L39,680.8203 " fill="#FBFB77" filter="url(#fllnwswvjzc9s)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1069,680.8203 L1069,690.8203 L1079,690.8203 L1069,680.8203 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="463" x="321.25" y="697.8872">The handshake has started and now the server sends its VC to the client</text><path d="M263.5,721.9531 L553.5,721.9531 L553.5,728.9531 L543.5,738.9531 L263.5,738.9531 L263.5,721.9531 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="303.3281" style="stroke: #000000; stroke-width: 2.0;" width="968.5" x="263.5" y="721.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="245" x="278.5" y="735.02">CONSTRUCT SERVER CERTIFICATE</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="347" y1="760.2188" y2="760.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="347" y1="760.2188" y2="773.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="306" x2="347" y1="773.2188" y2="773.2188"/><polygon fill="#A80036" points="316,769.2188,306,773.2188,316,777.2188,312,773.2188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="312" y="755.1528">tls_construct_server_certificate(*vc)</text><polygon fill="#A80036" points="553,798.3516,563,802.3516,553,806.3516,557,802.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="559" y1="802.3516" y2="802.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="312" y="797.2856">OSSL_ENCODER_to_bio(*vc)</text><path d="M507,817.3516 L641,817.3516 L641,824.3516 L631,834.3516 L507,834.3516 L507,817.3516 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="604.5" x="507" y="817.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="522" y="830.4185">ENCODE_OP</text><polygon fill="#A80036" points="848,851.6172,858,855.6172,848,859.6172,852,855.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="854" y1="855.6172" y2="855.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="572" y="850.5513">vc_to_SubjectPublicKeyInfo_der_encode()</text><polygon fill="#A80036" points="1007,880.75,1017,884.75,1007,888.75,1011,884.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="1013" y1="884.75" y2="884.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="867" y="879.6841">get_vc()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1019" x2="1061" y1="920.8828" y2="920.8828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1061" x2="1061" y1="920.8828" y2="933.8828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1020" x2="1061" y1="933.8828" y2="933.8828"/><polygon fill="#A80036" points="1030,929.8828,1020,933.8828,1030,937.8828,1026,933.8828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="1026" y="915.8169">get_vc()</text><polygon fill="#A80036" points="871,959.0156,861,963.0156,871,967.0156,867,963.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="865" x2="1018" y1="963.0156" y2="963.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="877" y="957.9497">return const char *vc</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="902" y1="998.2148" y2="998.2148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="902" x2="902" y1="998.2148" y2="1011.2148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="902" y1="1011.2148" y2="1011.2148"/><polygon fill="#A80036" points="871,1007.2148,861,1011.2148,871,1015.2148,867,1011.2148" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="867" y="993.1489">BIO_write()</text><path d="M948,976.0156 L948,1016.0156 L1213,1016.0156 L1213,986.0156 L1203,976.0156 L948,976.0156 " fill="#FBFB77" filter="url(#fllnwswvjzc9s)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1203,976.0156 L1203,986.0156 L1213,986.0156 L1203,976.0156 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="954" y="993.0825">Writes data on the BIO and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="954" y="1008.2153">that will later be sent over the network</text><path d="M8,1037.2813 L8,1062.2813 L1108,1062.2813 L1108,1047.2813 L1098,1037.2813 L8,1037.2813 " fill="#FBFB77" filter="url(#fllnwswvjzc9s)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1098,1037.2813 L1098,1047.2813 L1108,1047.2813 L1098,1037.2813 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="1079" x="14" y="1054.3481">After the Certificate message the server sends the Certificate Verify message by signing all the handshake message with the private key associated to its DID Document</text><path d="M263.5,1078.4141 L610.5,1078.4141 L610.5,1085.4141 L600.5,1095.4141 L263.5,1095.4141 L263.5,1078.4141 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="316.3281" style="stroke: #000000; stroke-width: 2.0;" width="1039.5" x="263.5" y="1078.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="302" x="278.5" y="1091.481">CONSTRUCT SERVER CERTIFICATE VERIFY</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="347" y1="1116.6797" y2="1116.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="347" y1="1116.6797" y2="1129.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="306" x2="347" y1="1129.6797" y2="1129.6797"/><polygon fill="#A80036" points="316,1125.6797,306,1129.6797,316,1133.6797,312,1129.6797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="312" y="1111.6138">tls_construct_cert_verify(*vc)</text><polygon fill="#A80036" points="553,1154.8125,563,1158.8125,553,1162.8125,557,1158.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="559" y1="1158.8125" y2="1158.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="312" y="1153.7466">EVP_DigestSignInit(*vc)</text><path d="M507,1173.8125 L662,1173.8125 L662,1180.8125 L652,1190.8125 L507,1190.8125 L507,1173.8125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="95.3984" style="stroke: #000000; stroke-width: 2.0;" width="786" x="507" y="1173.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="522" y="1186.8794">SIGNATURE_OP</text><polygon fill="#A80036" points="848,1213.0781,858,1217.0781,848,1221.0781,852,1217.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="854" y1="1217.0781" y2="1217.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="572" y="1212.0122">vc_sig_newctx(signature-&gt;provider)</text><path d="M865,1195.9453 L865,1220.9453 L1083,1220.9453 L1083,1205.9453 L1073,1195.9453 L865,1195.9453 " fill="#FBFB77" filter="url(#fllnwswvjzc9s)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1073,1195.9453 L1073,1205.9453 L1083,1205.9453 L1073,1195.9453 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="871" y="1213.0122">Saves in *vc_sig_ctx the Wallet</text><polygon fill="#A80036" points="848,1252.2109,858,1256.2109,848,1260.2109,852,1256.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="854" y1="1256.2109" y2="1256.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="572" y="1251.145">vc_digest_sign_init(*vc_sig_ctx, *did)</text><path d="M865,1235.0781 L865,1260.0781 L1274,1260.0781 L1274,1245.0781 L1264,1235.0781 L865,1235.0781 " fill="#FBFB77" filter="url(#fllnwswvjzc9s)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1264,1235.0781 L1264,1245.0781 L1274,1245.0781 L1264,1235.0781 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="388" x="871" y="1252.145">Saves in vc_sig_ctx the DID needed to perform the signature</text><polygon fill="#A80036" points="553,1293.3438,563,1297.3438,553,1301.3438,557,1297.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="559" y1="1297.3438" y2="1297.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="312" y="1292.2778">EVP_DigestSign(*vc)</text><path d="M507,1312.3438 L662,1312.3438 L662,1319.3438 L652,1329.3438 L507,1329.3438 L507,1312.3438 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="604.5" x="507" y="1312.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="522" y="1325.4106">SIGNATURE_OP</text><polygon fill="#A80036" points="848,1346.6094,858,1350.6094,848,1354.6094,852,1350.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="854" y1="1350.6094" y2="1350.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="572" y="1345.5435">vc_digest_sign()</text><polygon fill="#A80036" points="1007,1375.7422,1017,1379.7422,1007,1383.7422,1011,1379.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="1013" y1="1379.7422" y2="1379.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="867" y="1374.6763">did_sign()</text><path d="M39,1406.7422 L39,1431.7422 L1079,1431.7422 L1079,1416.7422 L1069,1406.7422 L39,1406.7422 " fill="#FBFB77" filter="url(#fllnwswvjzc9s)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1069,1406.7422 L1069,1416.7422 L1079,1416.7422 L1069,1406.7422 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="299" x="403.25" y="1423.8091">The server now processes the Client Certificate</text><path d="M263.5,1447.875 L527.5,1447.875 L527.5,1454.875 L517.5,1464.875 L263.5,1464.875 L263.5,1447.875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="251.0625" style="stroke: #000000; stroke-width: 2.0;" width="868" x="263.5" y="1447.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="219" x="278.5" y="1460.9419">PROCESS CLIENT CERTIFICATE</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="347" y1="1486.1406" y2="1486.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="347" y1="1486.1406" y2="1499.1406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="306" x2="347" y1="1499.1406" y2="1499.1406"/><polygon fill="#A80036" points="316,1495.1406,306,1499.1406,316,1503.1406,312,1499.1406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="312" y="1481.0747">tls_process_client_certificate(char *vc)</text><polygon fill="#A80036" points="553,1524.2734,563,1528.2734,553,1532.2734,557,1528.2734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="559" y1="1528.2734" y2="1528.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="312" y="1523.2075">OSSL_DECODER_from_bio(*vc)</text><path d="M507,1543.2734 L641,1543.2734 L641,1550.2734 L631,1560.2734 L507,1560.2734 L507,1543.2734 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="148.6641" style="stroke: #000000; stroke-width: 2.0;" width="614.5" x="507" y="1543.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="522" y="1556.3403">DECODE_OP</text><polygon fill="#A80036" points="848,1577.5391,858,1581.5391,848,1585.5391,852,1581.5391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="854" y1="1581.5391" y2="1581.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="572" y="1576.4731">SubjectPublicKeyInfo_der_to_vc_decode()</text><path d="M791,1596.5391 L938,1596.5391 L938,1603.5391 L928,1613.5391 L791,1613.5391 L791,1596.5391 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="88.3984" style="stroke: #000000; stroke-width: 2.0;" width="320.5" x="791" y="1596.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="806" y="1609.606">KEYMGMT_OP</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="902" y1="1634.8047" y2="1634.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="902" x2="902" y1="1634.8047" y2="1647.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="861" x2="902" y1="1647.8047" y2="1647.8047"/><polygon fill="#A80036" points="871,1643.8047,861,1647.8047,871,1651.8047,867,1647.8047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="867" y="1629.7388">vc_load()</text><polygon fill="#A80036" points="1007,1672.9375,1017,1676.9375,1007,1680.9375,1011,1676.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="1013" y1="1676.9375" y2="1676.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="867" y="1671.8716">set_vc()</text><path d="M39,1710.9375 L39,1735.9375 L1079,1735.9375 L1079,1720.9375 L1069,1710.9375 L39,1710.9375 " fill="#FBFB77" filter="url(#fllnwswvjzc9s)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1069,1710.9375 L1069,1720.9375 L1079,1720.9375 L1069,1710.9375 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="383.25" y="1728.0044">The server now processes the Client Certificate Verify</text><path d="M263.5,1752.0703 L584.5,1752.0703 L584.5,1759.0703 L574.5,1769.0703 L263.5,1769.0703 L263.5,1752.0703 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="375.7266" style="stroke: #000000; stroke-width: 2.0;" width="1042.5" x="263.5" y="1752.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="276" x="278.5" y="1765.1372">PROCESS CLIENT CERTIFICATE VERIFY</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="347" y1="1790.3359" y2="1790.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="347" x2="347" y1="1790.3359" y2="1803.3359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="306" x2="347" y1="1803.3359" y2="1803.3359"/><polygon fill="#A80036" points="316,1799.3359,306,1803.3359,316,1807.3359,312,1803.3359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="312" y="1785.27">tls_process_cert_verify(*vc)</text><polygon fill="#A80036" points="553,1828.4688,563,1832.4688,553,1836.4688,557,1832.4688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="559" y1="1832.4688" y2="1832.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="312" y="1827.4028">EVP_DigestVerifyInit(*vc)</text><path d="M507,1847.4688 L662,1847.4688 L662,1854.4688 L652,1864.4688 L507,1864.4688 L507,1847.4688 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="154.7969" style="stroke: #000000; stroke-width: 2.0;" width="789" x="507" y="1847.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="522" y="1860.5356">SIGNATURE_OP</text><polygon fill="#A80036" points="848,1886.7344,858,1890.7344,848,1894.7344,852,1890.7344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="854" y1="1890.7344" y2="1890.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="572" y="1885.6685">vc_sig_newctx(signature-&gt;provider)</text><path d="M865,1869.6016 L865,1894.6016 L1076,1894.6016 L1076,1879.6016 L1066,1869.6016 L865,1869.6016 " fill="#FBFB77" filter="url(#fllnwswvjzc9s)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1066,1869.6016 L1066,1879.6016 L1076,1879.6016 L1066,1869.6016 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="871" y="1886.6685">Saves in vc_sig_ctx the Wallet</text><polygon fill="#A80036" points="848,1920.8672,858,1924.8672,848,1928.8672,852,1924.8672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="854" y1="1924.8672" y2="1924.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="572" y="1919.8013">vc_digest_verify_init(*vc_sig_ctx, *vc)</text><polygon fill="#A80036" points="1007,1970.1328,1017,1974.1328,1007,1978.1328,1011,1974.1328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="1013" y1="1974.1328" y2="1974.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="867" y="1969.0669">vc_verify()</text><path d="M1024,1937.8672 L1024,1992.8672 L1277,1992.8672 L1277,1947.8672 L1267,1937.8672 L1024,1937.8672 " fill="#FBFB77" filter="url(#fllnwswvjzc9s)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1267,1937.8672 L1267,1947.8672 L1277,1947.8672 L1267,1937.8672 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="1030" y="1954.9341">VC verify is performed here because</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1034" y="1970.0669">in the signature operation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="1034" y="1985.1997">we have the wallet</text><polygon fill="#A80036" points="553,2026.3984,563,2030.3984,553,2034.3984,557,2030.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="305" x2="559" y1="2030.3984" y2="2030.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="312" y="2025.3325">EVP_DigestVerify(*vc)</text><path d="M507,2045.3984 L662,2045.3984 L662,2052.3984 L652,2062.3984 L507,2062.3984 L507,2045.3984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.3984" style="stroke: #000000; stroke-width: 2.0;" width="604.5" x="507" y="2045.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="522" y="2058.4653">SIGNATURE_OP</text><polygon fill="#A80036" points="848,2079.6641,858,2083.6641,848,2087.6641,852,2083.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="565" x2="854" y1="2083.6641" y2="2083.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="572" y="2078.5981">vc_digest_verify()</text><polygon fill="#A80036" points="1007,2108.7969,1017,2112.7969,1007,2116.7969,1011,2112.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="1013" y1="2112.7969" y2="2112.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="867" y="2107.731">did_verify()</text><!--MD5=[bc5bf8d25c0f88a1c6397c23e506e8fc]
@startuml
participant S_SERVER as app
participant LIBSSL as lssl
participant LIBCRYPTO as lcrypto
participant DEFAULT_PROVIDER as dfltprov
participant SSI_PROVIDER as ssiprov
participant IDENTITY_CBINDINGS as id

note over app, id: The server first loads its VC and DID into EVP_PKEY *VC and EVP_PKEY *did that are stored in an appropriate data structure in LIBSSL

group LOAD DID
app -> app: load_key(did_document.pem)
app -> lcrypto: OSSL_DECODER_from_bio()
lcrypto -> dfltprov: pem2der_decode()
group DECODE_OP
lcrypto -> ssiprov: PrivateKeyInfo_der_to_vc_decode()
end
group KEYMGMT_OP
ssiprov -> ssiprov: vc_load()
ssiprov -> id: did_set()
end
end

group LOAD VC
app -> app: load_key(jwt.pem)
app -> lcrypto: OSSL_DECODER_from_bio(jwt.pem)
lcrypto -> dfltprov: pem2der_decode()
group DECODE_OP
lcrypto -> ssiprov: PublicKeyInfo_der_to_vc_decode()
end
group KEYMGMT_OP
ssiprov -> ssiprov: vc_load()
ssiprov -> id: vc_set()
end
end 

note over app, id: The handshake has started and now the server sends its VC to the client

group CONSTRUCT SERVER CERTIFICATE
lssl -> lssl: tls_construct_server_certificate(*vc)
lssl -> lcrypto: OSSL_ENCODER_to_bio(*vc)
group ENCODE_OP
lcrypto -> ssiprov: vc_to_SubjectPublicKeyInfo_der_encode()
ssiprov -> id: get_vc()
end
id -> id: get_vc()
id -> ssiprov: return const char *vc
ssiprov -> ssiprov: BIO_write()
note right: Writes data on the BIO and \nthat will later be sent over the network
end

note over app, id: After the Certificate message the server sends the Certificate Verify message by signing all the handshake message with the private key associated to its DID Document

group CONSTRUCT SERVER CERTIFICATE VERIFY
lssl -> lssl: tls_construct_cert_verify(*vc)
lssl -> lcrypto: EVP_DigestSignInit(*vc)
group SIGNATURE_OP
lcrypto -> ssiprov: vc_sig_newctx(signature->provider)
note right: Saves in *vc_sig_ctx the Wallet
lcrypto -> ssiprov: vc_digest_sign_init(*vc_sig_ctx, *did) 
note right: Saves in vc_sig_ctx the DID needed to perform the signature
end
lssl -> lcrypto: EVP_DigestSign(*vc)
group SIGNATURE_OP
lcrypto -> ssiprov: vc_digest_sign()
ssiprov -> id: did_sign()
end
end

note over app, id: The server now processes the Client Certificate

group PROCESS CLIENT CERTIFICATE
lssl -> lssl: tls_process_client_certificate(char *vc)
lssl -> lcrypto: OSSL_DECODER_from_bio(*vc)
group DECODE_OP
lcrypto -> ssiprov: SubjectPublicKeyInfo_der_to_vc_decode()
group KEYMGMT_OP
ssiprov -> ssiprov: vc_load()
ssiprov -> id: set_vc()
end
end
end

note over app, id: The server now processes the Client Certificate Verify

group PROCESS CLIENT CERTIFICATE VERIFY
lssl -> lssl: tls_process_cert_verify(*vc)
lssl -> lcrypto: EVP_DigestVerifyInit(*vc)
group SIGNATURE_OP
lcrypto -> ssiprov: vc_sig_newctx(signature->provider)
note right: Saves in vc_sig_ctx the Wallet 
lcrypto -> ssiprov: vc_digest_verify_init(*vc_sig_ctx, *vc)
ssiprov -> id: vc_verify()
note right: VC verify is performed here because\n in the signature operation\n we have the wallet
end
lssl -> lcrypto: EVP_DigestVerify(*vc)
group SIGNATURE_OP
lcrypto -> ssiprov: vc_digest_verify()
ssiprov -> id: did_verify()
end
end
@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.22+7-post-Ubuntu-0ubuntu222.04.1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>